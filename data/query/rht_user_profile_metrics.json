{
  "id": "rht_user_profile_metrics",
  "description": "RHT User Profile Metrics",
  "default": {
    "sys_content_type": [ "rht_user_profile" ]
  },
  "template" : "{\n    \"size\":  0,\n    \"query\": {\n        \"filtered\": {\n            \"filter\": {\n                \"and\": [\n                    { \n                        \"match_all\" : { } \n                    }\n                    {{#date_from}}\n                    , {\n                        \"range\": {\n                            \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessTimestamp\": {\n                                \"gte\": \"{{date_from}}\",\n                                \"time_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n                            }\n                        }\n                    }\n                    {{/date_from}}\n                    {{#date_to}}\n                    , {\n                        \"range\": {\n                            \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessTimestamp\": {\n                                \"lt\": \"{{date_to}}\",\n                                \"time_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n                            }\n                        }\n                    }\n                    {{/date_to}}\n                ]\n            }\n        }\n    },\n    \"aggs\": {\n        \"first_access_agg\": {\n            \"date_histogram\": {\n                \"field\": \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessTimestamp\",\n                \"order\": { \"_key\": \"asc\" },\n                \"interval\" : \"{{interval}}{{^interval}}month{{/interval}}\",\n                \"format\": \"{{bucket_key_format}}{{^bucket_key_format}}yyyy-MM{{/bucket_key_format}}\",\n                \"pre_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n            }\n            ,\"aggs\" : {\n              \"by_channel\" : { \n                \"filters\" : {\n                  \"filters\" : {\n                    \"website\" : { \n                        \"and\": [ \n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\" : \"website\"   } },\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\" : false } }\n                        ]\n                    },\n                    \"website_from_rh\" : {\n                        \"and\": [\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\" : \"website\" } },\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\" : true } }\n                        ]\n                    },\n                    \"infoq\" :   {\n                        \"and\": [\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\" : \"infoq\"   } },\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\" : false } }\n                        ]\n                    },\n                    \"infoq_from_rh\" :   {\n                        \"and\": [\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\" : \"infoq\"   } },\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\" : true } }\n                        ]\n                    },\n                    \"dzone\" :   {\n                        \"and\": [\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\" : \"dzone\" } },\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\" : false } }\n                        ]\n                    },\n                    \"dzone_from_rh\" :   {\n                        \"and\": [\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\" : \"dzone\" } },\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\" : true } }\n                        ]\n                    },\n                    \"conference\" :   {\n                        \"and\": [\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\" : \"conference\"   } },\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\" : false } }\n                        ]\n                    },\n                    \"conference_from_rh\" :   {\n                        \"and\": [\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\" : \"conference\"   } },\n                            { \"term\" : { \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\" : true } }\n                        ]\n                    }\n                  }\n                }\n              }\n            }\n        }\n    }\n}"
}
